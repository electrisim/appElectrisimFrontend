<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Transformer Parameters</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #007bff;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Transformer Parameters Test</h1>
        <p>This test verifies that all transformer parameters are properly handled in the frontend dialog.</p>
        
        <div class="test-section">
            <h3>Test 1: Create Transformer Dialog</h3>
            <p>Click the button below to create a transformer dialog and verify all parameters are present.</p>
            <button onclick="testTransformerDialog()">Create Transformer Dialog</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>Test 2: Check Parameter Tabs</h3>
            <p>Verify that all parameter tabs are present and contain the expected parameters.</p>
            <button onclick="checkParameterTabs()">Check Parameter Tabs</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>Test 3: Verify Reorganized Parameters</h3>
            <p>Check that parameters are properly distributed across tabs after reorganization.</p>
            <button onclick="checkReorganizedParameters()">Check Reorganized Parameters</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>Expected Parameters</h3>
            <div class="info">
                <h4>Load Flow Tab:</h4>
                <ul>
                    <li>Name, Rated Apparent Power, HV/LV Rated Voltage, In Service, Vector Group</li>
                    <li><strong>Angle Shift (shift_degree)</strong>, <strong>Parallel Transformers (parallel)</strong></li>
                    <li><strong>Tap Side, Tap Neutral Position, Min/Max Tap Position</strong></li>
                    <li><strong>Tap Step Percent/Degree, Current Tap Position, Phase Shifter</strong></li>
                </ul>
                
                <h4>Short Circuit Tab:</h4>
                <ul>
                    <li>Short Circuit Voltage (vk_percent), Real Part of SC Voltage (vkr_percent)</li>
                    <li>Iron Losses (pfe_kw), Open Loop Losses (i0_percent)</li>
                    <li><strong>Zero Sequence SC Voltage (vk0_percent), Zero Sequence SC Voltage Real Part (vkr0_percent)</strong></li>
                    <li><strong>Zero Sequence Magnetizing Current (mag0_percent), Zero Sequence Magnetizing R/X Ratio (mag0_rx)</strong></li>
                    <li><strong>Zero Sequence Partial Current (si0_hv_partial)</strong></li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the transformer dialog
        import { TransformerDialog, defaultTransformerData } from './src/main/webapp/js/electrisim/transformerBaseDialog.js';
        
        // Make it available globally
        window.TransformerDialog = TransformerDialog;
        window.defaultTransformerData = defaultTransformerData;
        
        window.testTransformerDialog = function() {
            const resultDiv = document.getElementById('result1');
            try {
                const dialog = new TransformerDialog();
                resultDiv.innerHTML = '<div class="success">✓ Transformer dialog created successfully!</div>';
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ Error creating transformer dialog: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
        };
        
        window.checkParameterTabs = function() {
            const resultDiv = document.getElementById('result2');
            try {
                const dialog = new TransformerDialog();
                
                // Check if all parameter arrays exist
                const hasLoadFlow = dialog.loadFlowParameters && dialog.loadFlowParameters.length > 0;
                const hasShortCircuit = dialog.shortCircuitParameters && dialog.shortCircuitParameters.length > 0;
                const hasOPF = dialog.opfParameters && dialog.opfParameters.length > 0;
                
                let result = '<div class="success">✓ Parameter tabs check:</div><ul>';
                result += `<li>Load Flow: ${hasLoadFlow ? '✓' : '✗'} (${dialog.loadFlowParameters?.length || 0} parameters)</li>`;
                result += `<li>Short Circuit: ${hasShortCircuit ? '✓' : '✗'} (${dialog.shortCircuitParameters?.length || 0} parameters)</li>`;
                result += `<li>OPF: ${hasOPF ? '✗ (Removed)' : '✓ (Removed)'} (${dialog.opfParameters?.length || 0} parameters)</li>`;
                result += '</ul>';
                
                resultDiv.innerHTML = result;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ Error checking parameter tabs: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
        };
        
        window.checkReorganizedParameters = function() {
            const resultDiv = document.getElementById('result3');
            try {
                const dialog = new TransformerDialog();
                
                // Check for key parameters in their new locations
                const loadFlowParamIds = dialog.loadFlowParameters?.map(p => p.id) || [];
                const shortCircuitParamIds = dialog.shortCircuitParameters?.map(p => p.id) || [];
                
                // Check if shift_degree and parallel are in Load Flow tab
                const shiftDegreeInLoadFlow = loadFlowParamIds.includes('shift_degree');
                const parallelInLoadFlow = loadFlowParamIds.includes('parallel');
                
                // Check if tap parameters are in Load Flow tab (moved from OPF)
                const tapParams = ['tap_side', 'tap_neutral', 'tap_min', 'tap_max', 'tap_step_percent', 'tap_step_degree', 'tap_pos', 'tap_phase_shifter'];
                const tapInLoadFlow = tapParams.every(param => loadFlowParamIds.includes(param));
                
                // Check if zero sequence parameters are in Short Circuit tab
                const zeroSeqParams = ['vk0_percent', 'vkr0_percent', 'mag0_percent', 'mag0_rx', 'si0_hv_partial'];
                const zeroSeqInShortCircuit = zeroSeqParams.every(param => shortCircuitParamIds.includes(param));
                
                let result = '<div class="success">✓ Reorganized parameters check:</div><ul>';
                result += `<li>shift_degree in Load Flow: ${shiftDegreeInLoadFlow ? '✓' : '✗'}</li>`;
                result += `<li>parallel in Load Flow: ${parallelInLoadFlow ? '✓' : '✗'}</li>`;
                result += `<li>Tap parameters in Load Flow: ${tapInLoadFlow ? '✓' : '✗'}</li>`;
                result += `<li>Zero sequence parameters in Short Circuit: ${zeroSeqInShortCircuit ? '✓' : '✗'}</li>`;
                result += '</ul>';
                
                // Detailed parameter distribution
                result += '<div class="info"><strong>Parameter Distribution:</strong><ul>';
                result += '<li><strong>Load Flow Tab:</strong></li>';
                loadFlowParamIds.forEach(param => {
                    result += `<li style="margin-left: 20px;">- ${param}</li>`;
                });
                result += '<li><strong>Short Circuit Tab:</strong></li>';
                shortCircuitParamIds.forEach(param => {
                    result += `<li style="margin-left: 20px;">- ${param}</li>`;
                });
                result += '</ul></div>';
                
                resultDiv.innerHTML = result;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ Error checking reorganized parameters: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
        };
    </script>
</body>
</html>
