console.log("Starting OptimalPowerFlowDialog initialization..."),function initOptimalPowerFlowDialog(){console.log("Initializing OptimalPowerFlowDialog as standalone...");const e=window.ensureSubscriptionFunctions;console.log("ensureSubscriptionFunctions available:",!!e);class OptimalPowerFlowDialog{constructor(e){console.log("OptimalPowerFlowDialog constructor called with:",e),this.ui=e||window.App?.main?.editor?.editorUi,this.graph=this.ui?.editor?.graph,this.title="Optimal Power Flow Parameters",this.submitButtonText="Calculate",console.log("OptimalPowerFlowDialog: this.ui:",!!this.ui),console.log("OptimalPowerFlowDialog: this.graph:",!!this.graph),this.parameters=[{id:"opf_type",label:"OPF Type",type:"radio",options:[{value:"ac",label:"AC Optimal Power Flow (runopp)",default:!0},{value:"dc",label:"DC Optimal Power Flow (rundcopp)"}]},{id:"frequency",label:"Frequency",type:"radio",options:[{value:"50",label:"50 Hz",default:!0},{value:"60",label:"60 Hz"}]},{id:"ac_algorithm",label:"AC Algorithm",type:"radio",options:[{value:"pypower",label:"PYPOWER",default:!0},{value:"powermodels",label:"PowerModels.jl (Not available)"}],dependsOn:"opf_type",showWhen:"ac"},{id:"dc_algorithm",label:"DC Algorithm",type:"radio",options:[{value:"pypower",label:"PYPOWER",default:!0},{value:"powermodels",label:"PowerModels.jl (Not available)"}],dependsOn:"opf_type",showWhen:"dc"},{id:"calculate_voltage_angles",label:"Calculate Voltage Angles",type:"radio",options:[{value:"auto",label:"Auto",default:!0},{value:!0,label:"True"},{value:!1,label:"False"}]},{id:"init",label:"Initialization",type:"radio",options:[{value:"pf",label:"Power Flow",default:!0},{value:"flat",label:"Flat"},{value:"results",label:"Previous Results"}]},{id:"delta",label:"Delta (Convergence Tolerance)",type:"number",value:"1e-8",step:"1e-10"},{id:"trafo_model",label:"Transformer Model",type:"radio",options:[{value:"t",label:"Exact Model (t)",default:!0},{value:"pi",label:"Pi Model (pi)"}]},{id:"trafo_loading",label:"Transformer Loading",type:"radio",options:[{value:"current",label:"Current",default:!0},{value:"power",label:"Power"}]},{id:"ac_line_model",label:"AC Line Model",type:"radio",options:[{value:"pi",label:"Pi Model",default:!0},{value:"t",label:"T Model"}],dependsOn:"opf_type",showWhen:"ac"},{id:"numba",label:"Use Numba (Performance)",type:"checkbox",value:!0},{id:"suppress_warnings",label:"Suppress Warnings",type:"checkbox",value:!0},{id:"cost_function",label:"Cost Function Type",type:"radio",options:[{value:"polynomial",label:"Polynomial Cost"},{value:"piecewise_linear",label:"Piecewise Linear Cost"},{value:"none",label:"No Cost Function",default:!0}]},{id:"min_p_mw",label:"Generator Min P (MW)",type:"number",value:"0",step:"0.01"},{id:"max_p_mw",label:"Generator Max P (MW)",type:"number",value:"10",step:"0.01"}],console.log("OptimalPowerFlowDialog: constructor completed, parameters length:",this.parameters.length)}getDescription(){return"<strong>Configure Optimal Power Flow calculation parameters</strong><br>AC OPF uses pandapower.runopp for full AC optimal power flow.<br>DC OPF uses pandapower.rundcopp for linearized DC optimal power flow.<br><em>Note: Cost functions should be defined on generators for meaningful optimization.</em>"}show(e){console.log("OptimalPowerFlowDialog.show() called");const t=document.createElement("div");t.style.cssText="\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0, 0, 0, 0.5);\n                    z-index: 10000;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                ";const o=document.createElement("div");o.style.cssText="\n                    background: white;\n                    border-radius: 8px;\n                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n                    max-width: 600px;\n                    max-height: 80vh;\n                    overflow-y: auto;\n                    padding: 20px;\n                    margin: 20px;\n                    font-family: Arial, sans-serif;\n                ";const n=document.createElement("h2");n.textContent=this.title,n.style.cssText="\n                    margin: 0 0 16px 0;\n                    color: #333;\n                    font-size: 18px;\n                ",o.appendChild(n);const l=document.createElement("div");l.innerHTML=this.getDescription(),l.style.cssText="\n                    padding: 10px;\n                    background: #e3f2fd;\n                    border: 1px solid #bbdefb;\n                    border-radius: 4px;\n                    margin-bottom: 16px;\n                    font-size: 12px;\n                    color: #1565c0;\n                ",o.appendChild(l);const i=document.createElement("form"),a=[];this.parameters.forEach((e,t)=>{const o=document.createElement("div");o.style.cssText="\n                        margin-bottom: 16px;\n                        border-bottom: 1px solid #eee;\n                        padding-bottom: 12px;\n                    ";const n=document.createElement("label");if(n.textContent=e.label,n.style.cssText="\n                        display: block;\n                        margin-bottom: 8px;\n                        font-weight: bold;\n                        color: #333;\n                    ",o.appendChild(n),"radio"===e.type)e.options.forEach(n=>{const l=document.createElement("div");l.style.marginBottom="4px";const i=document.createElement("input");i.type="radio",i.name=e.id,i.value=n.value,i.id=`${e.id}_${n.value}`,n.default&&(i.checked=!0,a[t]=n.value),i.addEventListener("change",()=>{i.checked&&(a[t]=n.value)});const r=document.createElement("label");r.htmlFor=i.id,r.textContent=n.label,r.style.cssText="\n                                margin-left: 8px;\n                                font-weight: normal;\n                                cursor: pointer;\n                            ",l.appendChild(i),l.appendChild(r),o.appendChild(l)});else if("checkbox"===e.type){const n=document.createElement("input");n.type="checkbox",n.id=e.id,n.checked=e.value,a[t]=e.value,n.addEventListener("change",()=>{a[t]=n.checked});const l=document.createElement("label");l.htmlFor=n.id,l.textContent=" Enable",l.style.cssText="\n                            margin-left: 8px;\n                            font-weight: normal;\n                            cursor: pointer;\n                        ",o.appendChild(n),o.appendChild(l)}else if("number"===e.type){const n=document.createElement("input");n.type="number",n.id=e.id,n.value=e.value,n.step=e.step,a[t]=e.value,n.style.cssText="\n                            width: 100%;\n                            padding: 8px;\n                            border: 1px solid #ccc;\n                            border-radius: 4px;\n                            font-size: 14px;\n                        ",n.addEventListener("input",()=>{a[t]=n.value}),o.appendChild(n)}i.appendChild(o)});const r=this.graph.getChildCells(this.graph.getDefaultParent(),!0,!0).filter(e=>{const t=e.getStyle&&e.getStyle();return t&&t.includes("Generator")}),s={};if(r.length>0){const e=document.createElement("div");e.textContent="Per-Generator Min/Max P (MW)",e.style.cssText="margin: 16px 0 8px 0; font-weight: bold; color: #007cba;",i.appendChild(e)}r.forEach(e=>{const t=e.id,o=e.value?.getAttribute?.("name")||e.mxObjectId||t,n=e.value?.getAttribute?.("p_mw")||"",l=document.createElement("div");l.style.cssText="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;";const a=document.createElement("span");a.textContent=`Generator ${o} (P=${n})`,a.style.cssText="min-width: 120px; font-size: 13px;",l.appendChild(a);const r=document.createElement("input");r.type="number",r.value="0",r.step="0.01",r.style.cssText="width: 70px;",l.appendChild(document.createTextNode("Min:")),l.appendChild(r);const c=document.createElement("input");c.type="number",c.value=n||"10",c.step="0.01",c.style.cssText="width: 70px;",l.appendChild(document.createTextNode("Max:")),l.appendChild(c),s[t]={min:r,max:c},i.appendChild(l)}),o.appendChild(i);const c=document.createElement("div");c.style.cssText="\n                    display: flex;\n                    justify-content: flex-end;\n                    gap: 8px;\n                    margin-top: 20px;\n                ";const p=document.createElement("button");p.textContent="Cancel",p.type="button",p.style.cssText="\n                    padding: 8px 16px;\n                    border: 1px solid #ccc;\n                    background: white;\n                    border-radius: 4px;\n                    cursor: pointer;\n                ",p.addEventListener("click",()=>{document.body.removeChild(t)});const d=document.createElement("button");d.textContent=this.submitButtonText,d.type="button",d.style.cssText="\n                    padding: 8px 16px;\n                    border: 1px solid #007cba;\n                    background: #007cba;\n                    color: white;\n                    border-radius: 4px;\n                    cursor: pointer;\n                ",d.addEventListener("click",async()=>{console.log("OptimalPowerFlowDialog Calculate button clicked, values:",a);try{console.log("OptimalPowerFlowDialog: Starting subscription check...");const o=await this.checkSubscriptionStatus();if(console.log("OptimalPowerFlowDialog: Subscription check result:",o),!o)return console.log("OptimalPowerFlowDialog: No subscription, showing modal..."),document.body.removeChild(t),void(window.showSubscriptionModal?(console.log("OptimalPowerFlowDialog: Calling showSubscriptionModal"),window.showSubscriptionModal()):(console.error("OptimalPowerFlowDialog: Subscription modal not available"),alert("A subscription is required to use the Optimal Power Flow calculation feature.")));console.log("OptimalPowerFlowDialog: Subscription check passed, proceeding with calculation..."),document.body.removeChild(t);const n={};Object.keys(s).forEach(e=>{n[e]={min:parseFloat(s[e].min.value),max:parseFloat(s[e].max.value)}}),console.log("OptimalPowerFlowDialog: Calling callback with values array:",a),e&&e(a,n)}catch(e){console.error("OptimalPowerFlowDialog: Error checking subscription status:",e),alert("Unable to verify subscription status. Please try again.")}}),c.appendChild(p),c.appendChild(d),o.appendChild(c),t.appendChild(o),document.body.appendChild(t),t.addEventListener("click",e=>{e.target===t&&document.body.removeChild(t)});const handleEscape=e=>{"Escape"===e.key&&(document.body.removeChild(t),document.removeEventListener("keydown",handleEscape))};document.addEventListener("keydown",handleEscape)}async checkSubscriptionStatus(){try{return e&&"function"==typeof e.checkSubscriptionStatus?(console.log("OptimalPowerFlowDialog: Using ensureSubscriptionFunctions.checkSubscriptionStatus"),await e.checkSubscriptionStatus()):window.checkSubscriptionStatus&&"function"==typeof window.checkSubscriptionStatus?(console.log("OptimalPowerFlowDialog: Using window.checkSubscriptionStatus"),await window.checkSubscriptionStatus()):window.ensureSubscriptionFunctions&&"function"==typeof window.ensureSubscriptionFunctions.checkSubscriptionStatus?(console.log("OptimalPowerFlowDialog: Using window.ensureSubscriptionFunctions.checkSubscriptionStatus"),await window.ensureSubscriptionFunctions.checkSubscriptionStatus()):(console.warn("OptimalPowerFlowDialog: No subscription check function available"),!1)}catch(e){return console.error("OptimalPowerFlowDialog: Error in checkSubscriptionStatus:",e),!1}}}if("undefined"!=typeof globalThis?globalThis.OptimalPowerFlowDialog=OptimalPowerFlowDialog:"undefined"!=typeof window&&(window.OptimalPowerFlowDialog=OptimalPowerFlowDialog),"undefined"!=typeof module&&module.exports)module.exports={OptimalPowerFlowDialog:OptimalPowerFlowDialog};else if("object"==typeof exports)try{exports.OptimalPowerFlowDialog=OptimalPowerFlowDialog}catch(e){}console.log("OptimalPowerFlowDialog initialized and made available globally")}();