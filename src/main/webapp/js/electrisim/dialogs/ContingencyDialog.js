import{Dialog as e}from"../Dialog.js";import{ensureSubscriptionFunctions as n}from"../ensureSubscriptionFunctions.js";export class ContingencyDialog extends e{constructor(e){super("Contingency Analysis Parameters","Analyze"),this.ui=e||window.App?.main?.editor?.editorUi,this.graph=this.ui?.editor?.graph,this.parameters=[{id:"contingency_type",label:"Contingency Type",type:"radio",options:[{value:"N-1",label:"N-1 (Single Element Outage)",default:!0},{value:"N-2",label:"N-2 (Double Element Outage)"},{value:"N-K",label:"N-K (Multiple Element Outage)"}]},{id:"element_type",label:"Element Type to Analyze",type:"radio",options:[{value:"line",label:"Transmission Lines",default:!0},{value:"transformer",label:"Transformers"},{value:"generator",label:"Generators"},{value:"all",label:"All Elements"}]},{id:"elements_to_analyze",label:"Elements to Analyze",type:"radio",options:[{value:"all",label:"All Elements",default:!0},{value:"critical",label:"Critical Elements Only"},{value:"selected",label:"Selected Elements Only"}]},{id:"voltage_limits",label:"Check Voltage Limits",type:"radio",options:[{value:"true",label:"Yes",default:!0},{value:"false",label:"No"}]},{id:"thermal_limits",label:"Check Thermal Limits",type:"radio",options:[{value:"true",label:"Yes",default:!0},{value:"false",label:"No"}]},{id:"min_vm_pu",label:"Minimum Voltage (p.u.)",type:"number",value:"0.95",min:"0.5",max:"1.0",step:"0.01"},{id:"max_vm_pu",label:"Maximum Voltage (p.u.)",type:"number",value:"1.05",min:"1.0",max:"1.5",step:"0.01"},{id:"max_loading_percent",label:"Maximum Loading (%)",type:"number",value:"100",min:"50",max:"200",step:"1"},{id:"post_contingency_actions",label:"Post-Contingency Actions",type:"radio",options:[{value:"none",label:"No Actions",default:!0},{value:"redispatch",label:"Generation Redispatch"},{value:"load_shedding",label:"Load Shedding"},{value:"both",label:"Both Actions"}]},{id:"analysis_mode",label:"Analysis Mode",type:"radio",options:[{value:"fast",label:"Fast Screening",default:!0},{value:"detailed",label:"Detailed Analysis"},{value:"comprehensive",label:"Comprehensive Analysis"}]}]}getDescription(){return"<strong>Configure contingency analysis parameters</strong><br>Contingency analysis evaluates system security by simulating outages of network elements. N-1 analysis is the most common standard for power system security assessment."}show(e){console.log("ContingencyDialog.show() called"),super.show(async n=>{console.log("ContingencyDialog Analyze button clicked, values:",n);try{console.log("ContingencyDialog: Starting subscription check...");const o=await this.checkSubscriptionStatus();if(console.log("ContingencyDialog: Subscription check result:",o),!o)return console.log("ContingencyDialog: No subscription, showing modal..."),void(window.showSubscriptionModal?(console.log("ContingencyDialog: Calling showSubscriptionModal"),window.showSubscriptionModal()):(console.error("ContingencyDialog: Subscription modal not available"),alert("A subscription is required to use the Contingency Analysis feature.")));console.log("ContingencyDialog: Subscription check passed, proceeding with analysis...");const i=[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9]];console.log("ContingencyDialog: Calling callback with values array:",i),e&&e(i)}catch(e){console.error("ContingencyDialog: Error checking subscription status:",e),alert("Unable to verify subscription status. Please try again.")}})}async checkSubscriptionStatus(){console.log("ContingencyDialog.checkSubscriptionStatus() called");try{console.log("ContingencyDialog: Ensuring subscription functions are available...");const e=await n();if(console.log("ContingencyDialog: Functions status:",e),window.checkSubscriptionStatus){console.log("ContingencyDialog: Using window.checkSubscriptionStatus");const e=await window.checkSubscriptionStatus();return console.log("ContingencyDialog: window.checkSubscriptionStatus result:",e),e}if(window.SubscriptionManager&&window.SubscriptionManager.checkSubscriptionStatus){console.log("ContingencyDialog: Using SubscriptionManager.checkSubscriptionStatus");const e=await window.SubscriptionManager.checkSubscriptionStatus();return console.log("ContingencyDialog: SubscriptionManager result:",e),e}return console.warn("ContingencyDialog: No subscription check function available"),!1}catch(e){return console.error("ContingencyDialog: Error in checkSubscriptionStatus:",e),!1}}}globalThis.ContingencyDialog=ContingencyDialog;