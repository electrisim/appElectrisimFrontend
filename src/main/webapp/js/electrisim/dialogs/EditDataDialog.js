import{DIALOG_STYLES as e}from"../utils/dialogStyles.js";import{ExternalGridDialog as l}from"../externalGridDialog.js";import{AsymmetricLoadDialog as t}from"../asymmetricLoadDialog.js";import{AsymmetricStaticGeneratorDialog as i}from"../asymmetricStaticGeneratorDialog.js";import{CapacitorDialog as o}from"../capacitorDialog.js";import{DCLineDialog as a}from"../dcLineDialog.js";import{ExtendedWardDialog as n}from"../extendedWardDialog.js";import{GeneratorDialog as s}from"../generatorDialog.js";import{ImpedanceDialog as r}from"../impedanceDialog.js";import{LoadDialog as h}from"../loadDialog.js";import{MotorDialog as g}from"../motorDialog.js";import{ShuntReactorDialog as c}from"../shuntReactorDialog.js";import{SSCDialog as d}from"../SSCDialog.js";import{StaticGeneratorDialog as u}from"../staticGeneratorDialog.js";import{StorageDialog as w}from"../storageDialog.js";import{SVCDialog as p}from"../SVCDialog.js";import{TCSCDialog as m}from"../TCSCDialog.js";import{WardDialog as S}from"../wardDialog.js";import{BusDialog as f}from"../busDialog.js";import{TransformerDialog as D}from"../transformerBaseDialog.js";import{ThreeWindingTransformerDialog as b}from"../threeWindingTransformerBaseDialog.js";import{LineDialog as y}from"../lineBaseDialog.js";import{PVSystemDialog as v}from"../PVSystemDialog.js";export class EditDataDialog{constructor(e,l){try{if(!e||!l)throw new Error("EditDataDialog requires both UI and cell parameters");if(window._editDataDialogInstances||(window._editDataDialogInstances=new WeakMap),EditDataDialog.forceCleanupAll(l),this.performGlobalCleanup(),window._editDataDialogInstances.has(l)){const e=window._editDataDialogInstances.get(l);if(console.log("Found existing EditDataDialog instance for cell:",{cell:l,existingInstance:e,shouldShowDialog:e?.shouldShowDialog,cellDialogShowing:l._dialogShowing,globalDialogShowing:window._globalDialogShowing}),e&&!1!==e.shouldShowDialog&&!l._dialogShowing&&!window._globalDialogShowing)return console.log("EditDataDialog already exists for this cell, returning existing instance"),e;console.log("Cleaning up stale EditDataDialog instance for this cell"),window._editDataDialogInstances.delete(l),window._globalDialogShowing&&(console.log("Clearing stuck global dialog flag"),delete window._globalDialogShowing),l._dialogShowing&&(console.log("Clearing stuck cell dialog flag"),delete l._dialogShowing)}window._globalDialogShowing&&(console.log("Global dialog already showing, ignoring this instance. Current state:",{globalDialogShowing:window._globalDialogShowing,cellDialogShowing:l._dialogShowing,cell:l}),console.log("Force cleaning up stuck global dialog state"),delete window._globalDialogShowing,l._dialogShowing&&delete l._dialogShowing,window._editDataDialogInstances&&window._editDataDialogInstances.has(l)&&(console.log("Removing stuck instance from WeakMap"),window._editDataDialogInstances.delete(l))),this.ui=e,this.cell=l,this.shouldShowDialog=!0,this._isEditDataDialog=!0,window._editDataDialogInstances.set(l,this);const t=l.getStyle()||"",i=this.parseStyle(t);if(this.elementType=i.shapeELXXX,this.container=document.createElement("div"),"NotEditableLine"===this.elementType)return void this.handleNotEditableLine();if("Result"===this.elementType)return void this.handleResultElement();if("External Grid"===this.elementType)return void this.handleExternalGrid();if("Asymmetric Load"===this.elementType)return void this.handleAsymmetricLoad();if("Asymmetric Static Generator"===this.elementType)return void this.handleAsymmetricStaticGenerator();if("Capacitor"===this.elementType)return void this.handleCapacitor();if("DC Line"===this.elementType)return void this.handleDCLine();if("Extended Ward"===this.elementType)return void this.handleExtendedWard();if("Generator"===this.elementType)return void this.handleGenerator();if("Impedance"===this.elementType)return void this.handleImpedance();if("Load"===this.elementType)return void this.handleLoad();if("Motor"===this.elementType)return void this.handleMotor();if("Shunt Reactor"===this.elementType)return void this.handleShuntReactor();if("SSC(STATCOM)"===this.elementType)return void this.handleSSC();if("Static Generator"===this.elementType)return void this.handleStaticGenerator();if("Storage"===this.elementType)return void this.handleStorage();if("SVC"===this.elementType)return void this.handleSVC();if("TCSC"===this.elementType)return void this.handleTCSC();if("Ward"===this.elementType)return void this.handleWard();if("Bus"===this.elementType)return void this.handleBus();if("Transformer"===this.elementType)return void this.handleTransformer();if("Three Winding Transformer"===this.elementType)return void this.handleThreeWindingTransformer();if("Line"===this.elementType)return void this.handleLine();if("PVSystem"===this.elementType)return void this.handlePVSystem();this.container=this.createContainer()}catch(e){console.error("Error initializing EditDataDialog:",e),this.container=document.createElement("div"),this.container.textContent="Error loading dialog: "+e.message}}parseStyle(e){const l={};return e&&e.split(";").forEach(e=>{const[t,i]=e.split("=");t&&i&&(l[t.trim()]=i.trim())}),l}handleNotEditableLine(){this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._notEditableMessageShowing||document.querySelector(".not-editable-message-dialog")||(window._notEditableMessageShowing=!0,window._globalDialogShowing=!0,this.showStyledMessageDialog("Cannot Edit Element","This element cannot be edited. To model a line or cable, place it between two buses.","#FF9800","âš ï¸"))}handleResultElement(){this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._resultMessageShowing||document.querySelector(".not-editable-message-dialog")||(window._resultMessageShowing=!0,window._globalDialogShowing=!0,this.showStyledMessageDialog("Information","This element is a result label. It cannot be edited","#2196F3","ðŸ“Š"))}handleExternalGrid(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("External Grid dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new l(this.ui);this.setDialogCleanup(e),this.populateExternalGridDialog(e),e.show(e=>{console.log("External Grid dialog values received:",e),this.applyExternalGridValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing External Grid dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening External Grid dialog: "+e.message)}}}handleAsymmetricLoad(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Asymmetric Load dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new t(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Asymmetric Load dialog values received:",e),this.applyAsymmetricLoadValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Asymmetric Load dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Asymmetric Load dialog: "+e.message)}}}handleAsymmetricStaticGenerator(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Asymmetric Static Generator dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new i(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Asymmetric Static Generator dialog values received:",e),this.applyAsymmetricStaticGeneratorValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Asymmetric Static Generator dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Asymmetric Static Generator dialog: "+e.message)}}}handleCapacitor(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Capacitor dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new o(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Capacitor dialog values received:",e),this.applyCapacitorValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Capacitor dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Capacitor dialog: "+e.message)}}}handleDCLine(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("DC Line dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new a(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("DC Line dialog values received:",e),this.applyDCLineValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing DC Line dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening DC Line dialog: "+e.message)}}}handleExtendedWard(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Extended Ward dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new n(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Extended Ward dialog values received:",e),this.applyExtendedWardValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Extended Ward dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Extended Ward dialog: "+e.message)}}}handleGenerator(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Generator dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new s(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Generator dialog values received:",e),this.applyGeneratorValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Generator dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Generator dialog: "+e.message)}}}handleImpedance(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Impedance dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new r(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Impedance dialog values received:",e),this.applyImpedanceValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Impedance dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Impedance dialog: "+e.message)}}}handleLoad(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Load dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new h(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Load dialog values received:",e),this.applyLoadValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Load dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Load dialog: "+e.message)}}}handleMotor(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Motor dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new g(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Motor dialog values received:",e),this.applyMotorValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Motor dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Motor dialog: "+e.message)}}}handleShuntReactor(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Shunt Reactor dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new c(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Shunt Reactor dialog values received:",e),this.applyShuntReactorValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing Shunt Reactor dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Shunt Reactor dialog: "+e.message)}}}handleSSC(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("SSC dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new d(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("SSC dialog values received:",e),this.applySSCValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing SSC dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening SSC dialog: "+e.message)}}}handleStaticGenerator(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Static Generator dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new u(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Static Generator dialog values received:",e),this.applyStaticGeneratorValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing Static Generator dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Static Generator dialog: "+e.message)}}}handleStorage(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Storage dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new w(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Storage dialog values received:",e),this.applyStorageValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing Storage dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Storage dialog: "+e.message)}}}handleSVC(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("SVC dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new p(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("SVC dialog values received:",e),this.applySVCValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing SVC dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening SVC dialog: "+e.message)}}}handleTCSC(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("TCSC dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new m(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("TCSC dialog values received:",e),this.applyTCSCValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing TCSC dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening TCSC dialog: "+e.message)}}}handleWard(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Ward dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new S(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Ward dialog values received:",e),this.applyWardValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing Ward dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Ward dialog: "+e.message)}}}handleBus(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Bus dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new f(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Bus dialog values received:",e),this.applyBusValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing}),setTimeout(()=>{e.populateDialog(this.cell.value)},100)}catch(e){console.error("Error showing Bus dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Bus dialog: "+e.message)}}}handleTransformer(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",this.cell&&this.cell._dialogShowing&&(console.warn("WARNING: cell._dialogShowing was already set! Clearing stale flag..."),delete this.cell._dialogShowing),window._globalDialogShowing||document.querySelector(".modal-overlay"))return console.log("Transformer dialog: Another dialog is already showing, ignoring request"),void(this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing);window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0),this.cleanupTimeout=setTimeout(()=>{console.warn("Cleanup timeout reached for Transformer EditDataDialog - dialog may have been abandoned, forcing cleanup"),console.log("Cell state before timeout cleanup:",{cell:this.cell,cellDialogShowing:this.cell?._dialogShowing,globalDialogShowing:window._globalDialogShowing}),this.cleanup(),this.cell&&this.cell._dialogShowing&&(delete this.cell._dialogShowing,console.log("Timeout: Cleared stuck cell dialog flag"))},1e4);try{const e=new D(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log(">>> Transformer dialog callback invoked with values:",e),this.cell&&this.cell._dialogShowing&&(delete this.cell._dialogShowing,console.log("âœ“ Cleared cell._dialogShowing in callback (immediate)")),this.applyTransformerValues(e),this.cleanup(),window._globalDialogShowing&&(delete window._globalDialogShowing,console.log("âœ“ Cleared global flag in callback")),this.cell&&this.cell._dialogShowing?(console.error("WARNING: cell._dialogShowing still set after cleanup!"),delete this.cell._dialogShowing):console.log("âœ“ Verified cell flag is cleared in callback")})}catch(e){console.error("Error showing Transformer dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,this.performGlobalCleanup(),alert("Error opening Transformer dialog: "+e.message)}}handleThreeWindingTransformer(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Three Winding Transformer dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0,console.log("Set cell._dialogShowing flag for Three Winding Transformer dialog")),this.cleanupTimeout=setTimeout(()=>{console.warn("Cleanup timeout reached for Three Winding Transformer EditDataDialog - dialog may have been abandoned, forcing cleanup"),console.log("Cell state before timeout cleanup:",{cell:this.cell,cellDialogShowing:this.cell?._dialogShowing,globalDialogShowing:window._globalDialogShowing}),this.cleanup(),this.cell&&this.cell._dialogShowing&&(delete this.cell._dialogShowing,console.log("Timeout: Cleared stuck cell dialog flag"))},1e4);try{const e=new b(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Three Winding Transformer dialog values received:",e),this.applyThreeWindingTransformerValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Three Winding Transformer dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,this.performGlobalCleanup(),alert("Error opening Three Winding Transformer dialog: "+e.message)}}}handleLine(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("Line dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new y(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{console.log("Line dialog values received:",e),this.applyLineValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing Line dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening Line dialog: "+e.message)}}}handlePVSystem(){if(this.shouldShowDialog=!1,this.container.style.display="none",this.container.innerHTML="",window._globalDialogShowing||document.querySelector(".modal-overlay"))console.log("PVSystem dialog: Another dialog is already showing, ignoring request");else{window._globalDialogShowing=!0,this.cell&&(this.cell._dialogShowing=!0);try{const e=new v(this.ui);this.setDialogCleanup(e),e.populateDialog(this.cell.value),e.show(e=>{this.applyPVSystemValues(e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing})}catch(e){console.error("Error showing PVSystem dialog:",e),this.cleanup(),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,alert("Error opening PVSystem dialog: "+e.message)}}}populateAsymmetricLoadDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value,a=e.powerParameters.find(e=>e.id===i);a&&("checkbox"===a.type?a.value="true"===o||!0===o:a.value=o.toString());const n=e.reactivePowerParameters.find(e=>e.id===i);n&&(n.value=o.toString());const s=e.configParameters.find(e=>e.id===i);s&&("checkbox"===s.type?s.value="true"===o||!0===o:"select"===s.type?s.value=o:s.value=o.toString())}}ensureCellValueIsXmlElement(){if(this.cell.value){if("function"!=typeof this.cell.value.setAttribute){const e=this.cell.value;this.cell.value=mxUtils.createXmlDocument().createElement("object"),null!=e&&this.cell.value.setAttribute("label",e.toString())}}else this.cell.value=mxUtils.createXmlDocument().createElement("object")}applyAsymmetricLoadValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Asymmetric Load values applied to cell")}populateExternalGridDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value,a=e.loadFlowParameters.find(e=>e.id===i);a&&(a.value=o);const n=e.shortCircuitParameters.find(e=>e.id===i);n&&(n.value=o.toString());const s=e.opfParameters.find(e=>e.id===i);s&&("checkbox"===s.type?s.value="true"===o||!0===o:s.value=o.toString())}}applyExternalGridValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("External Grid values applied to cell")}populateAsymmetricStaticGeneratorDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateCapacitorDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateDCLineDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateExtendedWardDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateGeneratorDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateImpedanceDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateLoadDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateMotorDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateShuntReactorDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateSSCDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateStaticGeneratorDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateStorageDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateSVCDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateTCSCDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateWardDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateBusDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateTransformerDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}populateThreeWindingTransformerDialog(e){if(this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:l.value=o}}}applyAsymmetricStaticGeneratorValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Asymmetric Static Generator values applied to cell")}applyCapacitorValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Capacitor values applied to cell")}applyDCLineValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("DC Line values applied to cell")}applyExtendedWardValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Extended Ward values applied to cell")}applyGeneratorValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Generator values applied to cell")}applyImpedanceValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Impedance values applied to cell")}applyLoadValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Load values applied to cell")}applyMotorValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Motor values applied to cell")}applyShuntReactorValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Shunt Reactor values applied to cell")}applySSCValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("SSC values applied to cell")}applyStaticGeneratorValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Static Generator values applied to cell")}applyStorageValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Storage values applied to cell")}applySVCValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("SVC values applied to cell")}applyTCSCValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("TCSC values applied to cell")}applyWardValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Ward values applied to cell")}applyBusValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Bus values applied to cell")}applyTransformerValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Transformer values applied to cell")}applyThreeWindingTransformerValues(e){this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t);console.log("Three Winding Transformer values applied to cell")}createContainer(){if(!1===this.shouldShowDialog){const e=document.createElement("div");return e.style.display="none",e.style.visibility="hidden",e.style.position="absolute",e.style.left="-9999px",e}const e=document.createElement("div");try{e.classList.add("electrisim-dialog")}catch(e){}e.style.height="100%",e.style.width="100%",e.style.padding="0px",e.style.margin="0px",e.style.overflow="hidden",e.style.display="flex",e.style.flexDirection="column",e.setAttribute("class","ag-theme-alpine");const l=document.createElement("div");l.style.height="75px",l.style.width="100%",l.style.maxHeight="75px",l.style.minHeight="75px",l.style.overflow="hidden",l.style.flex="0 0 75px",l.style.position="relative",l.setAttribute("class","ag-theme-alpine");const{gridOptions:t,rowDefs:i}=this.getGridConfiguration();if(!t||!i)return e;if(t&&i)try{t.columnDefs&&t.columnDefs.forEach(e=>{const l=(e.headerName||e.field||"Column").length,t=Math.max(160,15*l+80);e.minWidth||(e.minWidth=t),e.width||(e.width=Math.max(180,t)),e.cellStyle||(e.cellStyle={"white-space":"normal","word-wrap":"break-word","text-overflow":"ellipsis"})}),t.headerHeight=30,t.rowHeight=26,t.suppressHorizontalScroll=!1,t.suppressVerticalScroll=!0,t.suppressScrollOnNewData=!0,t.suppressAnimationFrame=!0;const o=Math.max(1200,window.innerWidth-60),calculateOptimalColumnWidths=(e,l,t)=>{if(!e||0===e.length)return e;const i=e.length,o=l-50,a=Math.floor(o/i);let n=140;i>6&&(n=130),i>8&&(n=120),i>10&&(n=110),i>12&&(n=100),i>15&&(n=90),i>18&&(n=80);const s=Math.max(n,a);return e.map(e=>{let l=s;return"index"!==e.field&&"Index"!==e.headerName||(l=Math.min(70,s)),"id"!==e.field&&"ID"!==e.headerName&&"ID"!==e.field&&"id"!==e.headerName||(l=Math.min(80,s)),{...e,width:l,suppressSizeToFit:!1}})};t.columnDefs&&(t.columnDefs=calculateOptimalColumnWidths(t.columnDefs,o,this.elementType)),t.animateRows=!1,t.enableRangeSelection=!0,t.enableFillHandle=!0,t.enableRangeHandle=!0,t.undoRedoCellEditing=!0,t.undoRedoCellEditingLimit=20,t.rowHeight=24,t.headerHeight=28,t.suppressAnimationFrame=!0;const a=t.onGridReady;if(t.onGridReady=e=>{a&&a(e);try{if(e&&e.columnApi&&e.api&&l){const i=l.clientWidth-30,o=e.columnApi.getAllColumns();if(o&&o.length>0){const l=o.length*(t.columnDefs[0]?.width||150);Math.abs(l-i)>50&&e.api.sizeColumnsToFit()}}}catch(e){console.warn("Error in final column adjustment:",e)}},!window.agGrid)throw new Error("AG Grid library not loaded. Please ensure ag-grid-community.min.js is loaded before this module.");if(!t||!t.columnDefs)throw new Error("Grid configuration is invalid or missing. Please check the grid options.");new window.agGrid.Grid(l,t),this.populateGridData(t,i),e.appendChild(l)}catch(l){console.error("Error creating AG-Grid:",l),e.textContent="Error creating grid: "+l.message}else e.textContent=`Choose some component in the model first. Unsupported element type: ${this.elementType}`;const o=this.createButtonContainer(t||{});return o.style.position="relative",o.style.bottom="0px",o.style.marginTop="2px",o.style.marginBottom="0px",o.style.paddingTop="0px",o.style.paddingBottom="0px",o.style.height="28px",o.style.flex="0 0 28px",e.appendChild(o),e}getGridConfiguration(){if(!1===this.shouldShowDialog)return{gridOptions:null,rowDefs:null};const e={"External Grid":()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/ext_grid.html"}),Generator:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/gen.html"}),"Static Generator":()=>({gridOptions:window.gridOptionsStaticGenerator,rowDefs:window.rowDefsStaticGenerator,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/sgen.html"}),"Asymmetric Static Generator":()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/asymmetric_sgen.html"}),Bus:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/bus.html"}),"Shunt Reactor":()=>({gridOptions:window.gridOptionsShuntReactor,rowDefs:window.rowDefsShuntReactor,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/shunt.html"}),Capacitor:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/shunt.html"}),Load:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/load.html"}),"Asymmetric Load":()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/asymmetric_load.html"}),Impedance:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/impedance.html"}),Ward:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/ward.html"}),"Extended Ward":()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/xward.html"}),Motor:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/motor.html"}),Storage:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/storage.html"}),"DC Line":()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/dcline.html"}),Transformer:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/trafo.html",hasLibrary:!0}),"Three Winding Transformer":()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/trafo3w.html",hasLibrary:!0}),Line:()=>({gridOptions:window.gridOptionsLineBaseDialog,rowDefs:window.rowDefsDataLineBaseDialog,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/line.html",hasLibrary:!0}),SVC:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/svc.html",hasLibrary:!0}),TCSC:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/tcsc.html",hasLibrary:!0}),SSC:()=>({gridOptions:null,rowDefs:null,helpUrl:"https://pandapower.readthedocs.io/en/latest/elements/ssc.html",hasLibrary:!0})}[this.elementType];if(e){const l=e();return this.helpUrl=l.helpUrl,this.hasLibrary=l.hasLibrary,l}return{gridOptions:null,rowDefs:null}}populateGridData(e,l){if(!(e&&e.api&&l&&l[0]))return void console.warn("Grid options, API, or row definitions not available");const t=e.api.getRowNode("0");if(t){if(this.cell.value&&this.cell.value.attributes)for(let i=0;i<this.cell.value.attributes.length;i++){const o=this.cell.value.attributes[i],a=o.name,n=o.value;if(l[0].hasOwnProperty(a))try{this.safeSetDataValue(t,a,n,e)}catch(e){console.warn(`Error setting data value for ${a}:`,e)}}}else console.warn("Row node not found")}safeSetDataValue(e,l,t,i){if(!e||!l)return console.warn("rowNode or attributeName is null/undefined"),!1;try{const o=i.columnApi||i.api&&i.api.getColumnApi();return o&&o.getColumn&&!o.getColumn(l)?(console.warn(`Column '${l}' not found in grid definition`),!1):(e.setDataValue(l,t),!0)}catch(e){return console.warn(`Error setting data value for ${l}:`,e),!1}}createButtonContainer(e){e||(e={});const l=document.createElement("div");l.style.marginTop="4px",l.style.marginBottom="0px",l.style.paddingTop="0px",l.style.paddingBottom="0px",l.style.textAlign="center",l.style.whiteSpace="nowrap",l.style.height="28px",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.gap="6px",l.style.overflow="hidden";const t=this.createButton("Cancel",()=>{this.cleanup(),this.ui.hideDialog()});if(l.appendChild(t),this.hasLibrary){const e=this.createButton("Library",()=>{this.ui.hideDialog(),this.showLibraryDialog()});e.style.background="orange",e.style.verticalAlign="middle",l.appendChild(e)}if(this.helpUrl){const e=this.createButton("Help",()=>{this.ui.openLink(this.helpUrl)});e.style.verticalAlign="middle",l.appendChild(e)}const i=this.createButton("Apply",()=>{this.applyChanges(e),this.cleanup(),this.ui.hideDialog()});return i.className="geBtn gePrimaryBtn",i.style.verticalAlign="middle",l.appendChild(i),l}createButton(e,l){const t=mxUtils.button(e,l);return t.className="geBtn",t.style.margin="0 4px",t.style.height="26px",t.style.minWidth="70px",t.style.fontSize="12px",t}showLibraryDialog(){"Transformer"===this.elementType?this.ui.showTransformerDialog("","Apply",this.cell):"Three Winding Transformer"===this.elementType?this.ui.showThreeWindingTransformerDialog("","Apply",this.cell):"Line"===this.elementType&&this.ui.showLineDialog("","Apply",this.cell)}applyChanges(e){try{if(!e||!e.api)return void console.warn("Grid options or API not available for applying changes");const l=e.api.getRowNode("0");if(!l||!l.data)return void console.warn("Row node or data not available for applying changes");this.ensureCellValueIsXmlElement();for(const e in l.data)if(l.data.hasOwnProperty(e)){const t=l.data[e];this.cell.value.setAttribute(e,t)}console.log("Changes applied successfully")}catch(e){console.error("Error applying changes:",e)}}init(){}setDialogCleanup(e){const l=this,performCleanup=()=>{l.cleanup(),window._globalDialogShowing&&(delete window._globalDialogShowing,console.log("âœ“ Cleared global dialog flag")),l.cell&&(l.cell._dialogShowing&&(delete l.cell._dialogShowing,console.log("âœ“ Cleared cell._dialogShowing flag")),l.cell._dialogShowing&&console.error("ERROR: cell._dialogShowing still exists after deletion!"))};e.cleanupCallback=performCleanup;const t=e.destroy;e.destroy=function(){try{performCleanup()}catch(e){console.error("Error during cleanup in destroy:",e)}if(t)try{t.call(this)}catch(e){console.error("Error calling original destroy:",e)}},e._editDataDialogCleanup=performCleanup,e._hasCleanupHandler=!0}performGlobalCleanup(){window._globalDialogShowing&&(console.log("Found stuck global dialog flag, cleaning up"),delete window._globalDialogShowing),this.cell&&this.cell._dialogShowing&&(console.log("Found stuck cell dialog flag on current cell, cleaning up"),delete this.cell._dialogShowing),window._editDataDialogInstances}static forceCleanupAll(e){window._globalDialogShowing&&(delete window._globalDialogShowing,console.log("âœ“ Cleared global flag")),window._editDataDialogInstances&&(window._editDataDialogInstances=new WeakMap),e&&e._dialogShowing&&(delete e._dialogShowing,console.log("âœ“ Cleared cell flag"))}static{"undefined"!=typeof window&&(window.EditDataDialogForceCleanup=EditDataDialog.forceCleanupAll)}cleanup(){this.cell&&window._editDataDialogInstances&&window._editDataDialogInstances.has(this.cell)&&window._editDataDialogInstances.delete(this.cell),window._globalDialogShowing&&delete window._globalDialogShowing,this.cell&&this.cell._dialogShowing&&delete this.cell._dialogShowing,this.cleanupTimeout&&(clearTimeout(this.cleanupTimeout),this.cleanupTimeout=null)}showStyledMessageDialog(e,l,t,i){if(document.querySelector(".not-editable-message-dialog"))return void console.log("Message dialog already showing, ignoring duplicate");const o=document.createElement("div");o.className="not-editable-message-dialog",o.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            z-index: 10000;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        ",document.createElement("div").style.cssText="\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n            max-width: 480px;\n            width: 90%;\n            overflow: hidden;\n            animation: slideIn 0.3s ease-out;\n        ";const a=document.createElement("div");a.style.cssText=`\n            background: ${t};\n            color: white;\n            padding: 20px 24px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            font-size: 18px;\n            font-weight: 600;\n        `;const n=document.createElement("span");n.textContent=i,n.style.fontSize="24px";const s=document.createElement("span");s.textContent=e,a.appendChild(n),a.appendChild(s);const r=document.createElement("div");r.style.cssText="\n            padding: 24px;\n            font-size: 15px;\n            line-height: 1.5;\n            color: #333;\n        ",r.textContent=l,document.createElement("div").style.cssText="\n            padding: 16px 24px 24px;\n            text-align: right;\n        ";const h=document.createElement("button");h.textContent="OK",h.style.cssText=`\n            background: ${t};\n            color: white;\n            border: none;\n            border-radius: 6px;\n            padding: 10px 24px;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            min-width: 80px;\n        `,h.onmouseenter=()=>{h.style.transform="translateY(-1px)",h.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.2)"},h.onmouseleave=()=>{h.style.transform="translateY(0)",h.style.boxShadow="none"},h.onclick=()=>{o.style.animation="fadeOut 0.2s ease-in",setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o),o.className="",this.cell&&window._editDataDialogInstances&&window._editDataDialogInstances.has(this.cell)&&window._editDataDialogInstances.delete(this.cell),window._notEditableMessageShowing&&delete window._notEditableMessageShowing,window._resultMessageShowing&&delete window._resultMessageShowing,window._globalDialogShowing&&delete window._globalDialogShowing},200)},o.onclick=e=>{e.target===o&&h.click()};const handleKeyDown=e=>{"Escape"===e.key&&(h.click(),document.removeEventListener("keydown",handleKeyDown))};document.addEventListener("keydown",handleKeyDown),o.onclick=e=>{e.target===o&&h.click()},this.cleanup=()=>{this.cell&&window._editDataDialogInstances&&window._editDataDialogInstances.has(this.cell)&&window._editDataDialogInstances.delete(this.cell)}}populateLineDialog(e){if(e.inputs&&e.inputs.forEach((l,t)=>{let i="";e.data&&void 0!==e.data[t]&&(i=e.data[t]),"checkbox"===l.type?l.checked=Boolean(i):"SELECT"===l.tagName?l.value=i:l.value=i.toString()}),this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:"SELECT"===l.tagName?l.value=o:l.value=o.toString()}}console.log("Populated Line dialog with cell data")}applyLineValues(e){if(console.log("=== applyLineValues called ==="),console.log("Values to apply:",e),this.cell.value){if("function"!=typeof this.cell.value.setAttribute){console.log("Cell value is not an XML element, recreating it and preserving label");const e=this.cell.value;this.cell.value=mxUtils.createXmlDocument().createElement("object"),null!=e&&this.cell.value.setAttribute("label",e.toString())}console.log("Cell value exists, proceeding with attribute update");const l=this.cell.value.cloneNode(!0);if(console.log("Original cell value before modification:",l),this.cell.value.attributes){console.log(`Clearing ${this.cell.value.attributes.length} existing attributes`);const e=[];for(let l=0;l<this.cell.value.attributes.length;l++)e.push(this.cell.value.attributes[l].name);e.forEach(e=>{console.log(`  Removing attribute: ${e}`),this.cell.value.removeAttribute(e)})}if(console.log("Adding new attributes:"),Object.keys(e).forEach(l=>{const t=e[l];console.log(`  Setting ${l} = ${t} (${typeof t})`),this.cell.value.setAttribute(l,t)}),console.log("Verification - final cell attributes:"),this.cell.value.attributes)for(let e=0;e<this.cell.value.attributes.length;e++){const l=this.cell.value.attributes[e];console.log(`  ${l.name}: ${l.value}`)}if(this.graph){this.graph.model.beginUpdate();try{this.graph.model.setValue(this.cell,this.cell.value),console.log("Updated cell display via graph.model.setValue"),this.graph.refresh(this.cell),console.log("Forced cell refresh");const e=this.graph.model.getValue(this.cell);if(console.log("Cell value after graph update:",e),e&&e.attributes){console.log("Verification - cell attributes after graph update:");for(let l=0;l<e.attributes.length;l++){const t=e.attributes[l];console.log(`  ${t.name}: ${t.value}`)}}const cellChangeListener=(e,l)=>{const t=l.getProperty("edit").changes;for(let e=0;e<t.length;e++){const l=t[e];l.cell===this.cell&&l.value!==this.cell.value&&(console.log("ðŸš¨ WARNING: Cell value was changed by another process!"),console.log("  Original value we set:",this.cell.value),console.log("  New value after change:",l.value),console.log("  Change type:",l.constructor.name))}};this.graph.model.addListener(mxEvent.CHANGE,cellChangeListener),setTimeout(()=>{this.graph.model.removeListener(mxEvent.CHANGE,cellChangeListener),console.log("Removed temporary cell change listener")},1e3)}finally{this.graph.model.endUpdate(),console.log("Graph model update completed")}}else console.log("WARNING: No graph available for cell display update");console.log("=== applyLineValues completed ===")}else console.log("ERROR: Cell value is null/undefined")}populateTransformerDialog(e){if(e.inputs&&e.inputs.forEach((l,t)=>{let i="";e.data&&void 0!==e.data[t]&&(i=e.data[t]),"checkbox"===l.type?l.checked=Boolean(i):"SELECT"===l.tagName?l.value=i:l.value=i.toString()}),this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:"SELECT"===l.tagName?l.value=o:l.value=o.toString()}}console.log("Populated Transformer dialog with cell data")}applyTransformerValues(e){if(this.cell.value){if("function"!=typeof this.cell.value.setAttribute){const e=this.cell.value;this.cell.value=mxUtils.createXmlDocument().createElement("object"),null!=e&&this.cell.value.setAttribute("label",e.toString())}if(this.cell.value.attributes){const e=[];for(let l=0;l<this.cell.value.attributes.length;l++)e.push(this.cell.value.attributes[l].name);e.forEach(e=>{this.cell.value.removeAttribute(e)})}Object.keys(e).forEach(l=>{const t=e[l];this.cell.value.setAttribute(l,t)}),this.graph&&this.graph.model.setValue(this.cell,this.cell.value),console.log("Applied Transformer values to cell:",e)}}populateThreeWindingTransformerDialog(e){if(e.inputs&&e.inputs.forEach((l,t)=>{let i="";e.data&&void 0!==e.data[t]&&(i=e.data[t]),"checkbox"===l.type?l.checked=Boolean(i):"SELECT"===l.tagName?l.value=i:l.value=i.toString()}),this.cell.value&&this.cell.value.attributes)for(let l=0;l<this.cell.value.attributes.length;l++){const t=this.cell.value.attributes[l],i=t.name,o=t.value;if(e.inputs&&e.inputs.has(i)){const l=e.inputs.get(i);"checkbox"===l.type?l.checked="true"===o||!0===o:"SELECT"===l.tagName?l.value=o:l.value=o.toString()}}console.log("Populated Three Winding Transformer dialog with cell data")}applyThreeWindingTransformerValues(e){if(this.cell.value){if("function"!=typeof this.cell.value.setAttribute){const e=this.cell.value;this.cell.value=mxUtils.createXmlDocument().createElement("object"),null!=e&&this.cell.value.setAttribute("label",e.toString())}if(this.cell.value.attributes){const e=[];for(let l=0;l<this.cell.value.attributes.length;l++)e.push(this.cell.value.attributes[l].name);e.forEach(e=>{this.cell.value.removeAttribute(e)})}Object.keys(e).forEach(l=>{const t=e[l];this.cell.value.setAttribute(l,t)}),this.graph&&this.graph.model.setValue(this.cell,this.cell.value),console.log("Applied Three Winding Transformer values to cell:",e)}}applyPVSystemValues(e){try{this.ensureCellValueIsXmlElement();for(const[l,t]of Object.entries(e))this.cell.value.setAttribute(l,t)}catch(l){console.error("Error applying PVSystem values:",l);try{for(const[l,t]of Object.entries(e))this.cell.setAttribute(l,t);console.log("PVSystem values applied to cell using fallback method")}catch(e){console.error("Fallback method also failed:",e)}}}}EditDataDialog.placeholderHelpLink="https://pandapower.readthedocs.io/en/latest/elements.html",EditDataDialog.prototype.encode=function(){return null},window.addEventListener("load",function(){if("undefined"!=typeof mxCodecRegistry&&"undefined"!=typeof mxObjectCodec)try{const e=new mxObjectCodec({constructor:EditDataDialog,ui:null,cell:null,container:null},["ui","cell","container"]);e.encode=function(){return null},e.decode=function(){return null},mxCodecRegistry.register(e),console.log("EditDataDialog codec registered successfully")}catch(e){console.warn("Could not register EditDataDialog codec:",e)}}),"undefined"!=typeof window&&(window.EditDataDialog=EditDataDialog);